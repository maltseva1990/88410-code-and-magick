{"version":3,"sources":["webpack:///webpack/bootstrap cd99e09b55c2348ab048","webpack:///./src/main.js","webpack:///./src/form.js","webpack:///./src/game.js","webpack:///./src/game-stat.min.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;;AAEA;AACA;AACA;;;;;;;ACJA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gBAAe,SAAS;AACxB;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA,EAAC;;;;;;;ACjCD;;AAEA;AACA;AACA;AACA,aAAY;AACZ;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA,cAAa,OAAO;AACpB,eAAc;AACd;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;;AAEA;AACA;AACA,aAAY;AACZ;AACA;;AAEA;AACA;AACA,cAAa,OAAO;AACpB,eAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,eAAc;AACd;AACA;;AAEA,iBAAgB,QAAQ;AACxB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,SAAS;AACxB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,QAAO;AACP,MAAK;;AAEL;AACA;AACA,gBAAe,SAAS;AACxB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA,gBAAe,eAAe;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAqB,gBAAgB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,sBAAqB,sCAAsC;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,gBAAe,SAAS;AACxB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;;AAEP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,QAAO;;AAEP;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAkB;AAClB;AACA;AACA;AACA;AACA,sBAAqB,OAAO;AAC5B,uBAAsB;AACtB;AACA;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA;AACA,YAAW;;AAEX;AACA;AACA,sBAAqB,OAAO;AAC5B,uBAAsB;AACtB;AACA;AACA;AACA,YAAW;;AAEX;AACA;AACA,sBAAqB,OAAO;AAC5B,uBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,gBAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA,gBAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA,gBAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,EAAC;;;;;;;ACpvBD,cAAa,YAAY,wBAAwB,4BAA4B,WAAW,KAAK,mCAAmC,WAAW,KAAK,8CAA8C,4CAA4C,wBAAwB,kBAAkB,4JAA4J,aAAa,yjBAAyjB,aAAa,0CAA0C,kFAAkF,aAAa,gCAAgC,0EAA0E,mBAAmB,QAAQ,uBAAuB,gBAAgB,IAAI,gBAAgB,IAAI,kCAAkC,MAAM,wBAAwB,grBAAgrB,+BAA+B,iHAAiH,OAAO,wCAAwC,MAAM,sBAAsB,mBAAmB,SAAS,uBAAuB,uBAAuB,iJAAiJ,KAAK,kBAAkB,oVAAoV,aAAa,mCAAmC,OAAO,kEAAkE,uCAAuC,mEAAmE,uCAAuC,0TAA0T,4DAA4D,aAAa,wBAAwB,qMAAqM,4BAA4B,mBAAmB,mBAAmB,0EAA0E,sGAAsG,4BAA4B,2LAA2L,cAAc,oDAAoD,6BAA6B,iCAAiC,sLAAsL,MAAM,6LAA6L,MAAM,iQAAiQ,MAAM,oMAAoM,oCAAoC,oIAAoI,SAAS,uCAAuC,4DAA4D,EAAE,8BAA8B,MAAM,EAAE,gBAAgB,+BAA+B,uDAAuD,aAAa,2BAA2B,4CAA4C,qBAAqB,KAAK,wDAAwD,qJAAqJ,yDAAyD,4CAA4C,yFAAyF,OAAO,qBAAqB,wBAAwB,0CAA0C,iDAAiD,4EAA4E,6KAA6K,aAAa,4EAA4E,8LAA8L,aAAa,qBAAqB,wNAAwN,aAAa,cAAc,yDAAyD,qBAAqB,qBAAqB,mCAAmC,2BAA2B,EAAE,mBAAmB,MAAM,WAAW,+WAA+W,kBAAkB,aAAa,4CAA4C,GAAG,gEAAgE,yBAAyB,uCAAuC,4BAA4B,2BAA2B,2DAA2D,mBAAmB,mEAAmE,aAAa,kCAAkC,qHAAqH,OAAO,mBAAmB,4DAA4D,6CAA6C,0EAA0E,iGAAiG,cAAc,aAAa,MAAM,4EAA4E,wBAAwB,kBAAkB,0DAA0D,MAAM,2DAA2D,MAAM,wDAAwD,MAAM,yDAAyD,8CAA8C,sBAAsB,kBAAkB,uCAAuC,MAAM,wCAAwC,MAAM,qCAAqC,MAAM,sCAAsC,8CAA8C,qCAAqC,kGAAkG,iCAAiC,wGAAwG,oBAAoB,oCAAoC,qBAAqB,KAAK,mCAAmC,6BAA6B,gBAAgB,qCAAqC,6CAA6C,gEAAgE,wDAAwD,4CAA4C,4DAA4D,SAAS,oDAAoD,MAAM,G","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap cd99e09b55c2348ab048\n **/","'use strict';\r\n\r\nrequire('./form.js');\r\nrequire('./game.js');\r\nrequire('./game-stat.min.js');\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/main.js\n ** module id = 0\n ** module chunks = 0\n **/","'use strict';\r\n\r\nwindow.form = (function() {\r\n  var formContainer = document.querySelector('.overlay-container');\r\n  var formCloseButton = document.querySelector('.review-form-close');\r\n\r\n  var form = {\r\n    onClose: null,\r\n\r\n    /**\r\n     * @param {Function} cb\r\n     */\r\n    open: function(cb) {\r\n      formContainer.classList.remove('invisible');\r\n      cb();\r\n    },\r\n\r\n    close: function() {\r\n      formContainer.classList.add('invisible');\r\n\r\n      if (typeof this.onClose === 'function') {\r\n        this.onClose();\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  formCloseButton.onclick = function(evt) {\r\n    evt.preventDefault();\r\n    form.close();\r\n  };\r\n\r\n  return form;\r\n})();\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/form.js\n ** module id = 1\n ** module chunks = 0\n **/","'use strict';\r\n\r\nwindow.Game = (function() {\r\n  /**\r\n   * @const\r\n   * @type {number}\r\n   */\r\n  var HEIGHT = 300;\r\n\r\n  /**\r\n   * @const\r\n   * @type {number}\r\n   */\r\n  var WIDTH = 700;\r\n\r\n  /**\r\n   * ID уровней.\r\n   * @enum {number}\r\n   */\r\n  var Level = {\r\n    INTRO: 0,\r\n    MOVE_LEFT: 1,\r\n    MOVE_RIGHT: 2,\r\n    LEVITATE: 3,\r\n    HIT_THE_MARK: 4\r\n  };\r\n\r\n  /**\r\n   * Порядок прохождения уровней.\r\n   * @type {Array.<Level>}\r\n   */\r\n  var LevelSequence = [\r\n    Level.INTRO\r\n  ];\r\n\r\n  /**\r\n   * Начальный уровень.\r\n   * @type {Level}\r\n   */\r\n  var INITIAL_LEVEL = LevelSequence[0];\r\n\r\n  /**\r\n   * Допустимые виды объектов на карте.\r\n   * @enum {number}\r\n   */\r\n  var ObjectType = {\r\n    ME: 0,\r\n    FIREBALL: 1\r\n  };\r\n\r\n  /**\r\n   * Допустимые состояния объектов.\r\n   * @enum {number}\r\n   */\r\n  var ObjectState = {\r\n    OK: 0,\r\n    DISPOSED: 1\r\n  };\r\n\r\n  /**\r\n   * Коды направлений.\r\n   * @enum {number}\r\n   */\r\n  var Direction = {\r\n    NULL: 0,\r\n    LEFT: 1,\r\n    RIGHT: 2,\r\n    UP: 4,\r\n    DOWN: 8\r\n  };\r\n\r\n  /**\r\n   * Правила перерисовки объектов в зависимости от состояния игры.\r\n   * @type {Object.<ObjectType, function(Object, Object, number): Object>}\r\n   */\r\n  var ObjectsBehaviour = {};\r\n\r\n  /**\r\n   * Обновление движения мага. Движение мага зависит от нажатых в данный момент\r\n   * стрелок. Маг может двигаться одновременно по горизонтали и по вертикали.\r\n   * На движение мага влияет его пересечение с препятствиями.\r\n   * @param {Object} object\r\n   * @param {Object} state\r\n   * @param {number} timeframe\r\n   */\r\n  ObjectsBehaviour[ObjectType.ME] = function(object, state, timeframe) {\r\n    // Пока зажата стрелка вверх, маг сначала поднимается, а потом левитирует\r\n    // в воздухе на определенной высоте.\r\n    // NB! Сложность заключается в том, что поведение описано в координатах\r\n    // канваса, а не координатах, относительно нижней границы игры.\r\n    if (state.keysPressed.UP && object.y > 0) {\r\n      object.direction = object.direction & ~Direction.DOWN;\r\n      object.direction = object.direction | Direction.UP;\r\n      object.y -= object.speed * timeframe * 2;\r\n\r\n      if (object.y < 0) {\r\n        object.y = 0;\r\n      }\r\n    }\r\n\r\n    // Если стрелка вверх не зажата, а маг находится в воздухе, он плавно\r\n    // опускается на землю.\r\n    if (!state.keysPressed.UP) {\r\n      if (object.y < HEIGHT - object.height) {\r\n        object.direction = object.direction & ~Direction.UP;\r\n        object.direction = object.direction | Direction.DOWN;\r\n        object.y += object.speed * timeframe / 3;\r\n      } else {\r\n        object.Direction = object.direction & ~Direction.DOWN;\r\n      }\r\n    }\r\n\r\n    // Если зажата стрелка влево, маг перемещается влево.\r\n    if (state.keysPressed.LEFT) {\r\n      object.direction = object.direction & ~Direction.RIGHT;\r\n      object.direction = object.direction | Direction.LEFT;\r\n      object.x -= object.speed * timeframe;\r\n    }\r\n\r\n    // Если зажата стрелка вправо, маг перемещается вправо.\r\n    if (state.keysPressed.RIGHT) {\r\n      object.direction = object.direction & ~Direction.LEFT;\r\n      object.direction = object.direction | Direction.RIGHT;\r\n      object.x += object.speed * timeframe;\r\n    }\r\n\r\n    // Ограничения по перемещению по полю. Маг не может выйти за пределы поля.\r\n    if (object.y < 0) {\r\n      object.y = 0;\r\n      object.Direction = object.direction & ~Direction.DOWN;\r\n      object.Direction = object.direction & ~Direction.UP;\r\n    }\r\n\r\n    if (object.y > HEIGHT - object.height) {\r\n      object.y = HEIGHT - object.height;\r\n      object.Direction = object.direction & ~Direction.DOWN;\r\n      object.Direction = object.direction & ~Direction.UP;\r\n    }\r\n\r\n    if (object.x < 0) {\r\n      object.x = 0;\r\n    }\r\n\r\n    if (object.x > WIDTH - object.width) {\r\n      object.x = WIDTH - object.width;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Обновление движения файрбола. Файрбол выпускается в определенном направлении\r\n   * и после этого неуправляемо движется по прямой в заданном направлении. Если\r\n   * он пролетает весь экран насквозь, он исчезает.\r\n   * @param {Object} object\r\n   * @param {Object} state\r\n   * @param {number} timeframe\r\n   */\r\n  ObjectsBehaviour[ObjectType.FIREBALL] = function(object, state, timeframe) {\r\n    if (object.direction & Direction.LEFT) {\r\n      object.x -= object.speed * timeframe;\r\n    }\r\n\r\n    if (object.direction & Direction.RIGHT) {\r\n      object.x += object.speed * timeframe;\r\n    }\r\n\r\n    if (object.x < 0 || object.x > WIDTH) {\r\n      object.state = ObjectState.DISPOSED;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * ID возможных ответов функций, проверяющих успех прохождения уровня.\r\n   * CONTINUE говорит о том, что раунд не закончен и игру нужно продолжать,\r\n   * WIN о том, что раунд выигран, FAIL — о поражении. PAUSE о том, что игру\r\n   * нужно прервать.\r\n   * @enum {number}\r\n   */\r\n  var Verdict = {\r\n    CONTINUE: 0,\r\n    WIN: 1,\r\n    FAIL: 2,\r\n    PAUSE: 3,\r\n    INTRO: 4\r\n  };\r\n\r\n  /**\r\n   * Правила завершения уровня. Ключами служат ID уровней, значениями функции\r\n   * принимающие на вход состояние уровня и возвращающие true, если раунд\r\n   * можно завершать или false если нет.\r\n   * @type {Object.<Level, function(Object):boolean>}\r\n   */\r\n  var LevelsRules = {};\r\n\r\n  /**\r\n   * Уровень считается пройденным, если был выпущен файлболл и он улетел\r\n   * за экран.\r\n   * @param {Object} state\r\n   * @return {Verdict}\r\n   */\r\n  LevelsRules[Level.INTRO] = function(state) {\r\n    var fireballs = state.garbage.filter(function(object) {\r\n      return object.type === ObjectType.FIREBALL;\r\n    });\r\n\r\n    return fireballs.length ? Verdict.WIN : Verdict.CONTINUE;\r\n  };\r\n\r\n  /**\r\n   * Начальные условия для уровней.\r\n   * @enum {Object.<Level, function>}\r\n   */\r\n  var LevelsInitialize = {};\r\n\r\n  /**\r\n   * Первый уровень.\r\n   * @param {Object} state\r\n   * @return {Object}\r\n   */\r\n  LevelsInitialize[Level.INTRO] = function(state) {\r\n    state.objects.push(\r\n      // Установка персонажа в начальное положение. Он стоит в крайнем левом\r\n      // углу экрана, глядя вправо. Скорость перемещения персонажа на этом\r\n      // уровне равна 2px за кадр.\r\n      {\r\n        direction: Direction.RIGHT,\r\n        height: 84,\r\n        speed: 2,\r\n        sprite: 'img/wizard.gif',\r\n        spriteReversed: 'img/wizard-reversed.gif',\r\n        state: ObjectState.OK,\r\n        type: ObjectType.ME,\r\n        width: 61,\r\n        x: WIDTH / 3,\r\n        y: HEIGHT - 100\r\n      }\r\n    );\r\n\r\n    return state;\r\n  };\r\n\r\n  /**\r\n   * Конструктор объекта Game. Создает canvas, добавляет обработчики событий\r\n   * и показывает приветственный экран.\r\n   * @param {Element} container\r\n   * @constructor\r\n   */\r\n  var Game = function(container) {\r\n    this.container = container;\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.width = container.clientWidth;\r\n    this.canvas.height = container.clientHeight;\r\n    this.container.appendChild(this.canvas);\r\n\r\n    this.ctx = this.canvas.getContext('2d');\r\n\r\n    this._onKeyDown = this._onKeyDown.bind(this);\r\n    this._onKeyUp = this._onKeyUp.bind(this);\r\n    this._pauseListener = this._pauseListener.bind(this);\r\n\r\n    this.setDeactivated(false);\r\n  };\r\n\r\n  Game.prototype = {\r\n    /**\r\n     * Текущий уровень игры.\r\n     * @type {Level}\r\n     */\r\n    level: INITIAL_LEVEL,\r\n\r\n    /** @param {boolean} deactivated */\r\n    setDeactivated: function(deactivated) {\r\n      if (this._deactivated === deactivated) {\r\n        return;\r\n      }\r\n\r\n      this._deactivated = deactivated;\r\n\r\n      if (deactivated) {\r\n        this._removeGameListeners();\r\n      } else {\r\n        this._initializeGameListeners();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Состояние игры. Описывает местоположение всех объектов на игровой карте\r\n     * и время проведенное на уровне и в игре.\r\n     * @return {Object}\r\n     */\r\n    getInitialState: function() {\r\n      return {\r\n        // Статус игры. Если CONTINUE, то игра продолжается.\r\n        currentStatus: Verdict.CONTINUE,\r\n\r\n        // Объекты, удаленные на последнем кадре.\r\n        garbage: [],\r\n\r\n        // Время с момента отрисовки предыдущего кадра.\r\n        lastUpdated: null,\r\n\r\n        // Состояние нажатых клавиш.\r\n        keysPressed: {\r\n          ESC: false,\r\n          LEFT: false,\r\n          RIGHT: false,\r\n          SPACE: false,\r\n          UP: false\r\n        },\r\n\r\n        // Время начала прохождения уровня.\r\n        levelStartTime: null,\r\n\r\n        // Все объекты на карте.\r\n        objects: [],\r\n\r\n        // Время начала прохождения игры.\r\n        startTime: null\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Начальные проверки и запуск текущего уровня.\r\n     * @param {Level=} level\r\n     * @param {boolean=} restart\r\n     */\r\n    initializeLevelAndStart: function(level, restart) {\r\n      level = typeof level === 'undefined' ? this.level : level;\r\n      restart = typeof restart === 'undefined' ? true : restart;\r\n\r\n      if (restart || !this.state) {\r\n        // При перезапуске уровня, происходит полная перезапись состояния\r\n        // игры из изначального состояния.\r\n        this.state = this.getInitialState();\r\n        this.state = LevelsInitialize[this.level](this.state);\r\n      } else {\r\n        // При продолжении уровня состояние сохраняется, кроме записи о том,\r\n        // что состояние уровня изменилось с паузы на продолжение игры.\r\n        this.state.currentStatus = Verdict.CONTINUE;\r\n      }\r\n\r\n      // Запись времени начала игры и времени начала уровня.\r\n      this.state.levelStartTime = Date.now();\r\n      if (!this.state.startTime) {\r\n        this.state.startTime = this.state.levelStartTime;\r\n      }\r\n\r\n      this._preloadImagesForLevel(function() {\r\n        // Предварительная отрисовка игрового экрана.\r\n        this.render();\r\n\r\n        // Установка обработчиков событий.\r\n        this._initializeGameListeners();\r\n\r\n        // Запуск игрового цикла.\r\n        this.update();\r\n      }.bind(this));\r\n    },\r\n\r\n    /**\r\n     * Временная остановка игры.\r\n     * @param {Verdict=} verdict\r\n     */\r\n    pauseLevel: function(verdict) {\r\n      if (verdict) {\r\n        this.state.currentStatus = verdict;\r\n      }\r\n\r\n      this.state.keysPressed.ESC = false;\r\n      this.state.lastUpdated = null;\r\n\r\n      this._removeGameListeners();\r\n      window.addEventListener('keydown', this._pauseListener);\r\n\r\n      this._drawPauseScreen();\r\n    },\r\n\r\n    /**\r\n     * Обработчик событий клавиатуры во время паузы.\r\n     * @param {KeyboardsEvent} evt\r\n     * @private\r\n     * @private\r\n     */\r\n    _pauseListener: function(evt) {\r\n      if (evt.keyCode === 32 && !this._deactivated) {\r\n        evt.preventDefault();\r\n        var needToRestartTheGame = this.state.currentStatus === Verdict.WIN ||\r\n            this.state.currentStatus === Verdict.FAIL;\r\n        this.initializeLevelAndStart(this.level, needToRestartTheGame);\r\n\r\n        window.removeEventListener('keydown', this._pauseListener);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Отрисовка экрана паузы.\r\n     */\r\n    showMessage: function(message, messageWidth) {\r\n      messageWidth = messageWidth || 200;\r\n      var words = message.split(' ');\r\n      var countWords = words.length;\r\n      var line = '';\r\n      var lineNumber = '';\r\n      var lineStorage = {};\r\n      var countLines = 0;\r\n      var fontSize = 16;\r\n      this.ctx.font = fontSize + 'px PT Mono';\r\n\r\n      for (var i = 0; i < countWords; i++) {\r\n        var currentLine = line + words[i];\r\n        var currentWidth = this.ctx.measureText(currentLine).width;\r\n        if (currentWidth > messageWidth) {\r\n          countLines++;\r\n          lineNumber = 'line' + countLines;\r\n          lineStorage[lineNumber] = line;\r\n          line = words[i] + ' ';\r\n        } else {\r\n          line = currentLine + ' ';\r\n        }\r\n      }\r\n      countLines++;\r\n      lineNumber = 'line' + countLines;\r\n      lineStorage[lineNumber] = line.slice(0, -2);\r\n\r\n      var lineSpacing = 1.5;\r\n      var bGroundPadding = 40;\r\n      var bGroundWidth = messageWidth + bGroundPadding;\r\n      var bGroundHeight = fontSize * lineSpacing * countLines + bGroundPadding;\r\n      var bGroundPosX = WIDTH / 2 - bGroundWidth / 2;\r\n      var bGroundPosY = HEIGHT / 2 - bGroundHeight / 2;\r\n      var textPosX = bGroundPosX + bGroundPadding / 2;\r\n      var textPosY = bGroundPosY + bGroundPadding / 2;\r\n\r\n      this.ctx.shadowOffsetX = 7;\r\n      this.ctx.shadowOffsetY = 7;\r\n      this.ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';\r\n      this.ctx.fillStyle = '#FFFFFF';\r\n      this.ctx.fillRect(bGroundPosX, bGroundPosY, bGroundWidth, bGroundHeight);\r\n\r\n      var count = 0;\r\n      for (var j = 1; j <= Object.keys(lineStorage).length; j++) {\r\n        this.ctx.shadowOffsetX = 0;\r\n        this.ctx.shadowOffsetY = 0;\r\n        this.ctx.textBaseline = 'hanging';\r\n        this.ctx.fillStyle = 'darkblue';\r\n        this.ctx.fillText(lineStorage['line' + j], textPosX, textPosY + (fontSize * lineSpacing * count));\r\n        count++;\r\n      }\r\n    },\r\n\r\n    _drawPauseScreen: function() {\r\n      switch (this.state.currentStatus) {\r\n        case Verdict.WIN:\r\n\r\n          this.showMessage('You have won!', 150);\r\n          break;\r\n        case Verdict.FAIL:\r\n\r\n          this.showMessage('You have failed!', 200);\r\n          break;\r\n\r\n        case Verdict.PAUSE:\r\n          this.showMessage('Game is on pause!', 200);\r\n          break;\r\n        case Verdict.INTRO:\r\n\r\n          this.showMessage('Welcome to the game! You know what to do in order to start ', 200);\r\n          break;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Предзагрузка необходимых изображений для уровня.\r\n     * @param {function} callback\r\n     * @private\r\n     */\r\n    _preloadImagesForLevel: function(callback) {\r\n      if (typeof this._imagesArePreloaded === 'undefined') {\r\n        this._imagesArePreloaded = [];\r\n      }\r\n\r\n      if (this._imagesArePreloaded[this.level]) {\r\n        callback();\r\n        return;\r\n      }\r\n\r\n      var levelImages = [];\r\n      this.state.objects.forEach(function(object) {\r\n        levelImages.push(object.sprite);\r\n\r\n        if (object.spriteReversed) {\r\n          levelImages.push(object.spriteReversed);\r\n        }\r\n      });\r\n\r\n      var i = levelImages.length;\r\n      var imagesToGo = levelImages.length;\r\n\r\n      while (i-- > 0) {\r\n        var image = new Image();\r\n        image.src = levelImages[i];\r\n        image.onload = function() {\r\n          if (--imagesToGo === 0) {\r\n            this._imagesArePreloaded[this.level] = true;\r\n            callback();\r\n          }\r\n        }.bind(this);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Обновление статуса объектов на экране. Добавляет объекты, которые должны\r\n     * появиться, выполняет проверку поведения всех объектов и удаляет те, которые\r\n     * должны исчезнуть.\r\n     * @param {number} delta Время, прошеднее с отрисовки прошлого кадра.\r\n     */\r\n    updateObjects: function(delta) {\r\n      // Персонаж.\r\n      var me = this.state.objects.filter(function(object) {\r\n        return object.type === ObjectType.ME;\r\n      })[0];\r\n\r\n      // Добавляет на карту файрбол по нажатию на Shift.\r\n      if (this.state.keysPressed.SHIFT) {\r\n        this.state.objects.push({\r\n          direction: me.direction,\r\n          height: 24,\r\n          speed: 5,\r\n          sprite: 'img/fireball.gif',\r\n          type: ObjectType.FIREBALL,\r\n          width: 24,\r\n          x: me.direction & Direction.RIGHT ? me.x + me.width : me.x - 24,\r\n          y: me.y + me.height / 2\r\n        });\r\n\r\n        this.state.keysPressed.SHIFT = false;\r\n      }\r\n\r\n      this.state.garbage = [];\r\n\r\n      // Убирает в garbage не используемые на карте объекты.\r\n      var remainingObjects = this.state.objects.filter(function(object) {\r\n        ObjectsBehaviour[object.type](object, this.state, delta);\r\n\r\n        if (object.state === ObjectState.DISPOSED) {\r\n          this.state.garbage.push(object);\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      }, this);\r\n\r\n      this.state.objects = remainingObjects;\r\n    },\r\n\r\n    /**\r\n     * Проверка статуса текущего уровня.\r\n     */\r\n    checkStatus: function() {\r\n      // Нет нужны запускать проверку, нужно ли останавливать уровень, если\r\n      // заранее известно, что да.\r\n      if (this.state.currentStatus !== Verdict.CONTINUE) {\r\n        return;\r\n      }\r\n\r\n      if (!this.commonRules) {\r\n        /**\r\n         * Проверки, не зависящие от уровня, но влияющие на его состояние.\r\n         * @type {Array.<functions(Object):Verdict>}\r\n         */\r\n        this.commonRules = [\r\n          /**\r\n           * Если персонаж мертв, игра прекращается.\r\n           * @param {Object} state\r\n           * @return {Verdict}\r\n           */\r\n          function checkDeath(state) {\r\n            var me = state.objects.filter(function(object) {\r\n              return object.type === ObjectType.ME;\r\n            })[0];\r\n\r\n            return me.state === ObjectState.DISPOSED ?\r\n                Verdict.FAIL :\r\n                Verdict.CONTINUE;\r\n          },\r\n\r\n          /**\r\n           * Если нажата клавиша Esc игра ставится на паузу.\r\n           * @param {Object} state\r\n           * @return {Verdict}\r\n           */\r\n          function checkKeys(state) {\r\n            return state.keysPressed.ESC ? Verdict.PAUSE : Verdict.CONTINUE;\r\n          },\r\n\r\n          /**\r\n           * Игра прекращается если игрок продолжает играть в нее два часа подряд.\r\n           * @param {Object} state\r\n           * @return {Verdict}\r\n           */\r\n          function checkTime(state) {\r\n            return Date.now() - state.startTime > 3 * 60 * 1000 ?\r\n                Verdict.FAIL :\r\n                Verdict.CONTINUE;\r\n          }\r\n        ];\r\n      }\r\n\r\n      // Проверка всех правил влияющих на уровень. Запускаем цикл проверок\r\n      // по всем универсальным проверкам и проверкам конкретного уровня.\r\n      // Цикл продолжается до тех пор, пока какая-либо из проверок не вернет\r\n      // любое другое состояние кроме CONTINUE или пока не пройдут все\r\n      // проверки. После этого состояние сохраняется.\r\n      var allChecks = this.commonRules.concat(LevelsRules[this.level]);\r\n      var currentCheck = Verdict.CONTINUE;\r\n      var currentRule;\r\n\r\n      while (currentCheck === Verdict.CONTINUE && allChecks.length) {\r\n        currentRule = allChecks.shift();\r\n        currentCheck = currentRule(this.state);\r\n      }\r\n\r\n      this.state.currentStatus = currentCheck;\r\n    },\r\n\r\n    /**\r\n     * Принудительная установка состояния игры. Используется для изменения\r\n     * состояния игры от внешних условий, например, когда необходимо остановить\r\n     * игру, если она находится вне области видимости и установить вводный\r\n     * экран.\r\n     * @param {Verdict} status\r\n     */\r\n    setGameStatus: function(status) {\r\n      if (this.state.currentStatus !== status) {\r\n        this.state.currentStatus = status;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Отрисовка всех объектов на экране.\r\n     */\r\n    render: function() {\r\n      // Удаление всех отрисованных на странице элементов.\r\n      this.ctx.clearRect(0, 0, WIDTH, HEIGHT);\r\n\r\n      // Выставление всех элементов, оставшихся в this.state.objects согласно\r\n      // их координатам и направлению.\r\n      this.state.objects.forEach(function(object) {\r\n        if (object.sprite) {\r\n          var image = new Image(object.width, object.height);\r\n          image.src = (object.spriteReversed && object.direction & Direction.LEFT) ?\r\n              object.spriteReversed :\r\n              object.sprite;\r\n          this.ctx.drawImage(image, object.x, object.y, object.width, object.height);\r\n        }\r\n      }, this);\r\n    },\r\n\r\n    /**\r\n     * Основной игровой цикл. Сначала проверяет состояние всех объектов игры\r\n     * и обновляет их согласно правилам их поведения, а затем запускает\r\n     * проверку текущего раунда. Рекурсивно продолжается до тех пор, пока\r\n     * проверка не вернет состояние FAIL, WIN или PAUSE.\r\n     */\r\n    update: function() {\r\n      if (!this.state.lastUpdated) {\r\n        this.state.lastUpdated = Date.now();\r\n      }\r\n\r\n      var delta = (Date.now() - this.state.lastUpdated) / 10;\r\n      this.updateObjects(delta);\r\n      this.checkStatus();\r\n\r\n      switch (this.state.currentStatus) {\r\n        case Verdict.CONTINUE:\r\n          this.state.lastUpdated = Date.now();\r\n          this.render();\r\n          requestAnimationFrame(function() {\r\n            this.update();\r\n          }.bind(this));\r\n          break;\r\n\r\n        case Verdict.WIN:\r\n        case Verdict.FAIL:\r\n        case Verdict.PAUSE:\r\n        case Verdict.INTRO:\r\n          this.pauseLevel();\r\n          break;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @param {KeyboardEvent} evt [description]\r\n     * @private\r\n     */\r\n    _onKeyDown: function(evt) {\r\n      switch (evt.keyCode) {\r\n        case 37:\r\n          this.state.keysPressed.LEFT = true;\r\n          break;\r\n        case 39:\r\n          this.state.keysPressed.RIGHT = true;\r\n          break;\r\n        case 38:\r\n          this.state.keysPressed.UP = true;\r\n          break;\r\n        case 27:\r\n          this.state.keysPressed.ESC = true;\r\n          break;\r\n      }\r\n\r\n      if (evt.shiftKey) {\r\n        this.state.keysPressed.SHIFT = true;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @param {KeyboardEvent} evt [description]\r\n     * @private\r\n     */\r\n    _onKeyUp: function(evt) {\r\n      switch (evt.keyCode) {\r\n        case 37:\r\n          this.state.keysPressed.LEFT = false;\r\n          break;\r\n        case 39:\r\n          this.state.keysPressed.RIGHT = false;\r\n          break;\r\n        case 38:\r\n          this.state.keysPressed.UP = false;\r\n          break;\r\n        case 27:\r\n          this.state.keysPressed.ESC = false;\r\n          break;\r\n      }\r\n\r\n      if (evt.shiftKey) {\r\n        this.state.keysPressed.SHIFT = false;\r\n      }\r\n    },\r\n\r\n    /** @private */\r\n    _initializeGameListeners: function() {\r\n      window.addEventListener('keydown', this._onKeyDown);\r\n      window.addEventListener('keyup', this._onKeyUp);\r\n    },\r\n\r\n    /** @private */\r\n    _removeGameListeners: function() {\r\n      window.removeEventListener('keydown', this._onKeyDown);\r\n      window.removeEventListener('keyup', this._onKeyUp);\r\n    }\r\n  };\r\n\r\n  Game.Verdict = Verdict;\r\n\r\n  return Game;\r\n})();\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/game.js\n ** module id = 2\n ** module chunks = 0\n **/","\"use strict\";!function(){function a(a,b,c,d,e,f){for(var g=b.split(\"\\n\"),h=0;h<g.length;h++){for(var i=\"\",j=g[h].split(\" \"),k=0;k<j.length;k++){var l=i+j[k]+\" \",m=a.measureText(l),n=m.width;n>e?(a.fillText(i,c,d),i=j[k]+\" \",d+=f):i=l}a.fillText(i,c,d),d+=f}}function b(a,b,c){c.moveTo(a+.3*e,b+.3*d),c.lineTo(a+.8*e,b+.3*d-10),c.lineTo(a+.8*e-30,b+.7*d),c.lineTo(a+.3*e-30,b+.7*d+30),c.lineTo(a+.3*e+4,b+.3*d-4),c.fill(),c.stroke()}function c(){return\"function\"==typeof window.getMessage?window.getMessage.apply(null,arguments):\"\\u041d\\u0435 \\u043d\\u0430\\u0439\\u0434\\u0435\\u043d\\u0430 \\u0444\\u0443\\u043d\\u043a\\u0446\\u0438\\u044f getMessage, \\u043a\\u043e\\u0442\\u043e\\u0440\\u0430\\u044f \\u0434\\u043e\\u043b\\u0436\\u043d\\u0430 \\u0431\\u044b\\u0442\\u044c \\u043e\\u0431\\u044a\\u044f\\u0432\\u043b\\u0435\\u043d\\u0430 \\u0432 \\u0433\\u043b\\u043e\\u0431\\u0430\\u043b\\u044c\\u043d\\u043e\\u0439 \\u043e\\u0431\\u043b\\u0430\\u0441\\u0442\\u0438 \\u0432\\u0438\\u0434\\u0438\\u043c\\u043e\\u0441\\u0442\\u0438 \\u0432 \\u0444\\u0430\\u0439\\u043b\\u0435 check.js\"}function s(){var a=q.container.getBoundingClientRect();(a.bottom<.75*d||a.top>window.innerHeight-.5*d)&&q.setGameStatus(p.Verdict.PAUSE)}function w(){var a=r.getBoundingClientRect();a.bottom>0&&(r.style.backgroundPositionX=-document.body.scrollTop/2+\"px\")}var d=300,e=700,f={INTRO:0},g=[f.INTRO],h=g[0],i={ME:0,FIREBALL:1},j={OK:0,DISPOSED:1},k={NULL:0,LEFT:1,RIGHT:2,UP:4,DOWN:8},l={};l[i.ME]=function(a,b,c){b.keysPressed.UP&&a.y>0&&(a.direction=a.direction&~k.DOWN,a.direction=a.direction|k.UP,a.y-=a.speed*c*2,a.y<0&&(a.y=0)),b.keysPressed.UP||(a.y<d-a.height?(a.direction=a.direction&~k.UP,a.direction=a.direction|k.DOWN,a.y+=a.speed*c/3):a.direction=a.direction&~k.DOWN),b.keysPressed.LEFT&&(a.direction=a.direction&~k.RIGHT,a.direction=a.direction|k.LEFT,a.x-=a.speed*c),b.keysPressed.RIGHT&&(a.direction=a.direction&~k.LEFT,a.direction=a.direction|k.RIGHT,a.x+=a.speed*c),a.y<0&&(a.y=0,a.Direction=a.direction&~k.DOWN,a.Direction=a.direction&~k.UP),a.y>d-a.height&&(a.y=d-a.height,a.Direction=a.direction&~k.DOWN,a.Direction=a.direction&~k.UP),a.x<0&&(a.x=0),a.x>e-a.width&&(a.x=e-a.width)},l[i.FIREBALL]=function(a,b,c){a.direction&k.LEFT&&(a.x-=a.speed*c),a.direction&k.RIGHT&&(a.x+=a.speed*c),(a.x<0||a.x>e)&&(a.state=j.DISPOSED)};var m={CONTINUE:0,WIN:1,FAIL:2,PAUSE:3,INTRO:4},n={};n[f.INTRO]=function(){return m.CONTINUE};var o={};o[f.INTRO]=function(a){return a.objects.push({direction:k.RIGHT,height:84,speed:2,sprite:\"img/wizard.gif\",spriteReversed:\"img/wizard-reversed.gif\",state:j.OK,type:i.ME,width:61,x:e/2,y:d-100}),a};var p=function(a){this.container=a,this.canvas=document.createElement(\"canvas\"),this.canvas.width=a.clientWidth,this.canvas.height=a.clientHeight,this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext(\"2d\"),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._pauseListener=this._pauseListener.bind(this)};p.prototype={level:h,getInitialState:function(){return{currentStatus:m.CONTINUE,garbage:[],lastUpdated:null,keysPressed:{ESC:!1,LEFT:!1,RIGHT:!1,SPACE:!1,UP:!1},levelStartTime:null,objects:[],startTime:null,customMessage:null}},initializeLevelAndStart:function(a,b){a=\"undefined\"==typeof a?this.level:a,b=\"undefined\"==typeof b?!0:b,b||!this.state?this.state=this._getInitialLevelState(this.level):this.state.currentStatus=m.CONTINUE,this.state.levelStartTime=Date.now(),this.state.startTime||(this.state.startTime=this.state.levelStartTime),this._preloadImagesForLevel(function(){this.render(),this._initializeGameListeners(),this.update()}.bind(this))},pauseLevel:function(a){a&&(this.state.currentStatus=a),this.state.keysPressed.ESC=!1,this.state.lastUpdated=null,this._removeGameListeners(),window.addEventListener(\"keydown\",this._pauseListener),this._drawPauseScreen()},_pauseListener:function(a){if(32===a.keyCode){a.preventDefault();var b=this.state.currentStatus===m.WIN||this.state.currentStatus===m.FAIL;this.initializeLevelAndStart(this.level,b),window.removeEventListener(\"keydown\",this._pauseListener)}},_drawMessage:function(c,f){f=!!f,f?this.ctx.strokeStyle=\"red\":this.ctx.strokeStyle=\"#0066ff\",this.ctx.lineWidth=10,this.ctx.fillStyle=\"white\",this.ctx.font=\"16px PT Mono\",b(0,0,this.ctx),this.ctx.fillStyle=\"black\";var g=.3*d+30;f||(g+=30),a(this.ctx,c,.3*e+15,g,.75*e-.3*e-10,20)},_drawPauseScreen:function(){switch(this.state.currentStatus){case m.WIN:this._drawMessage(this.state.customMessage+\". \\u041f\\u0440\\u043e\\u0431\\u0435\\u043b \\u0434\\u043b\\u044f \\u0440\\u0435\\u0441\\u0442\\u0430\\u0440\\u0442\\u0430.\"||\"you have won!\");break;case m.FAIL:this._drawMessage(this.state.customMessage+\". \\u041f\\u0440\\u043e\\u0431\\u0435\\u043b \\u0434\\u043b\\u044f \\u0440\\u0435\\u0441\\u0442\\u0430\\u0440\\u0442\\u0430.\"||\"you have failed!\",!0);break;case m.PAUSE:this._drawMessage(\"\\u041f\\u0430\\u0443\\u0437\\u0430. \\u041d\\u0430\\u0436\\u043c\\u0438\\u0442\\u0435 \\u043f\\u0440\\u043e\\u0431\\u0435\\u043b \\u0434\\u043b\\u044f \\u043f\\u0440\\u043e\\u0434\\u043e\\u043b\\u0436\\u0435\\u043d\\u0438\\u044f \\u0438\\u0433\\u0440\\u044b\");break;case m.INTRO:this._drawMessage(\"\\u0414\\u043b\\u044f \\u043d\\u0430\\u0447\\u0430\\u043b\\u0430 \\u0438\\u0433\\u0440\\u044b \\u043d\\u0430\\u0436\\u043c\\u0438\\u0442\\u0435 \\u043f\\u0440\\u043e\\u0431\\u0435\\u043b\")}},_preloadImagesForLevel:function(a){if(\"undefined\"==typeof this._imagesArePreloaded&&(this._imagesArePreloaded=[]),this._imagesArePreloaded[this.level])return void a();var b=[];this.state.objects.forEach(function(a){b.push(a.sprite),a.spriteReversed&&b.push(a.spriteReversed)});for(var c=b.length,d=b.length;c-->0;){var e=new Image;e.src=b[c],e.onload=function(){0===--d&&(this._imagesArePreloaded[this.level]=!0,a())}.bind(this)}},updateObjects:function(a){var b=this.state.objects.filter(function(a){return a.type===i.ME})[0];this.state.keysPressed.SHIFT&&(this.state.objects.push({direction:b.direction,height:24,speed:5,sprite:\"img/fireball.gif\",type:i.FIREBALL,width:24,x:b.direction&k.RIGHT?b.x+b.width:b.x-24,y:b.y+b.height/2}),this.state.keysPressed.SHIFT=!1),this.state.garbage=[];var c=this.state.objects.filter(function(b){return l[b.type](b,this.state,a),b.state===j.DISPOSED?(this.state.garbage.push(b),!1):!0},this);this.state.objects=c},checkStatus:function(){if(this.state.currentStatus===m.CONTINUE){this.commonRules||(this.commonRules=[function(a){var b=this._getInitialLevelState(f.INTRO),d=this._getMe(a),e=this._getMe(b);return d.x-e.x>=200?(a.customMessage=c([1,2,3,4]),\"\\u042f \\u043f\\u0440\\u043e\\u0448\\u0451\\u043b 10 \\u0448\\u0430\\u0433\\u043e\\u0432\"===a.customMessage?m.WIN:m.FAIL):m.CONTINUE},function(a){var b=this._getInitialLevelState(f.INTRO),d=this._getMe(a),e=this._getMe(b);return d.x-e.x<=-200?(a.customMessage=c([1,2,3,4],[4,3,2,1]),\"\\u042f \\u043f\\u0440\\u043e\\u0448\\u0451\\u043b 20 \\u043c\\u0435\\u0442\\u0440\\u043e\\u0432\"===a.customMessage?m.WIN:m.FAIL):m.CONTINUE},function(a){var b=this._getMe(a);return b.y<=10?(a.customMessage=c(2),\"\\u042f \\u043f\\u0440\\u044b\\u0433\\u043d\\u0443\\u043b \\u043d\\u0430 200 \\u0441\\u0430\\u043d\\u0442\\u0438\\u043c\\u0435\\u0442\\u0440\\u043e\\u0432\"===a.customMessage?m.WIN:m.FAIL):m.CONTINUE},function(a){function g(a){return!!(a.direction&k.RIGHT)&&a.x>=e-10&&a.y>=b&&a.y<=f}var h,b=.5*d,f=.75*d;if(a.garbage.length){var j=a.garbage.filter(function(a){return a.type===i.FIREBALL});j.length&&(h=j[0])}if(h){var l=g(h);return a.customMessage=c(l,\"\\u043a\\u0440\\u043e\\u043d\\u0443 \\u0434\\u0435\\u0440\\u0435\\u0432\\u0430\"),l?\"\\u042f \\u043f\\u043e\\u043f\\u0430\\u043b \\u0432 \\u043a\\u0440\\u043e\\u043d\\u0443 \\u0434\\u0435\\u0440\\u0435\\u0432\\u0430\"===a.customMessage?m.WIN:m.FAIL:\"\\u042f \\u043d\\u0438\\u043a\\u0443\\u0434\\u0430 \\u043d\\u0435 \\u043f\\u043e\\u043f\\u0430\\u043b\"===a.customMessage?m.WIN:m.FAIL}return m.CONTINUE},function(a){return a.keysPressed.ESC?m.PAUSE:m.CONTINUE}]);for(var g,a=this.commonRules.concat(n[this.level]),b=m.CONTINUE;b===m.CONTINUE&&a.length;)g=a.shift(),b=g.call(this,this.state);this.state.currentStatus=b}},setGameStatus:function(a){this.state.currentStatus!==a&&(this.state.currentStatus=a)},render:function(){this.ctx.clearRect(0,0,e,d),this.state.objects.forEach(function(a){if(a.sprite){var b=new Image(a.width,a.height);b.src=a.spriteReversed&&a.direction&k.LEFT?a.spriteReversed:a.sprite,this.ctx.drawImage(b,a.x,a.y,a.width,a.height)}},this)},update:function(){this.state.lastUpdated||(this.state.lastUpdated=Date.now());var a=(Date.now()-this.state.lastUpdated)/10;switch(this.updateObjects(a),this.checkStatus(),this.state.currentStatus){case m.CONTINUE:this.state.lastUpdated=Date.now(),this.render(),requestAnimationFrame(function(){this.update()}.bind(this));break;case m.WIN:case m.FAIL:case m.PAUSE:case m.INTRO:default:this.pauseLevel()}},_onKeyDown:function(a){switch(a.keyCode){case 37:a.preventDefault(),this.state.keysPressed.LEFT=!0;break;case 39:a.preventDefault(),this.state.keysPressed.RIGHT=!0;break;case 38:a.preventDefault(),this.state.keysPressed.UP=!0;break;case 27:a.preventDefault(),this.state.keysPressed.ESC=!0}a.shiftKey&&(this.state.keysPressed.SHIFT=!0)},_onKeyUp:function(a){switch(a.keyCode){case 37:this.state.keysPressed.LEFT=!1;break;case 39:this.state.keysPressed.RIGHT=!1;break;case 38:this.state.keysPressed.UP=!1;break;case 27:this.state.keysPressed.ESC=!1}a.shiftKey&&(this.state.keysPressed.SHIFT=!1)},_initializeGameListeners:function(){window.addEventListener(\"keydown\",this._onKeyDown),window.addEventListener(\"keyup\",this._onKeyUp)},_removeGameListeners:function(){window.removeEventListener(\"keydown\",this._onKeyDown),window.removeEventListener(\"keyup\",this._onKeyUp)},_getMe:function(a){return a.objects.filter(function(a){return a.type===i.ME})[0]},_getInitialLevelState:function(a){var b=this.getInitialState();return o[a](b)}},window.Game=p,window.Game.Verdict=m;var q=new p(document.querySelector(\".demo\"));q.initializeLevelAndStart(),q.setGameStatus(p.Verdict.CONTINUE);var t,v,r=document.querySelector(\".header-clouds\"),u=!1;window.addEventListener(\"scroll\",function(){v||(v=Date.now()),u||(u=!0,requestAnimationFrame(function(){w(),u=!1})),clearTimeout(t),t=setTimeout(s,100),v=Date.now()}),w()}();\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/game-stat.min.js\n ** module id = 3\n ** module chunks = 0\n **/"],"sourceRoot":""}